FROM node:18-alpine

WORKDIR /app

# Root 레벨의 package 파일들 복사
COPY package*.json ./

# 클라이언트 디렉토리 복사
COPY client ./client

# 서버 디렉토리 복사
COPY server ./server

# 의존성 설치 및 클라이언트 빌드
RUN npm install && \
    cd client && npm install && npm run build && \
    cd ..

EXPOSE 3001

CMD ["npm", "run", "server"]
